import{V as e,W as t,n as r,v as s,X as a,Y as n}from"./index-CzxlOnnV.js";function o(e,t){return"string"==typeof e?t:e}const i={baseURL:"/api",timeout:6e4,header:{"Content-Type":"application/json"}},u=[],d=()=>{n()},l=e=>{!1!==e.loading&&a({title:"加载中...",mask:!0});const r=t("token");return r&&(e.header=e.header||{},e.header.Authorization=`Bearer ${r}`),e},c=t=>{!(t={...i,...t}).url.startsWith("http")&&i.baseURL&&(t.url=i.baseURL+t.url);const a=`${(t=l(t)||t).method}_${t.url}_${JSON.stringify(t.data)}`;if(t.preventDuplicate){const e=u.find((e=>e.key===a));if(e)return e.request}const n=new Promise(((n,o)=>{e({...t,success:e=>{u.splice(u.findIndex((e=>e.key===a)),1),((e,t)=>(!1!==t.loading&&d(),200===e.statusCode?Promise.resolve(e.data):Promise.reject(e)))(e,t).then((e=>n(e))).catch((e=>o(e)))},fail:e=>{u.splice(u.findIndex((e=>e.key===a)),1),((e,t)=>{!1!==t.loading&&d();let a="请求失败";return e.errMsg?a=e.errMsg:e.message&&(a=e.message),401===e.statusCode&&r({url:"@/pages/login/login"}),!1!==t.showError&&s({title:a,icon:"none",duration:2e3}),Promise.reject(e)})(e,t).catch((e=>o(e)))}})}));return t.preventDuplicate&&u.push({key:a,request:n}),n},p=(e,t={},r={})=>c({url:e,data:t,method:"GET",...r}),h=(e,t={},r={})=>c({url:e,data:t,method:"POST",...r});export{p as g,h as p,o as r};
