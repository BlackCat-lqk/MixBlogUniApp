"use strict";const e=require("../common/vendor.js"),t={baseURL:"https://m.mixblog.cn/api",timeout:6e4,header:{"Content-Type":"application/json"}},r=[],s=()=>{e.index.hideLoading()},n=t=>{!1!==t.loading&&e.index.showLoading({title:"加载中...",mask:!0});const r=e.index.getStorageSync("token");return r&&(t.header=t.header||{},t.header.Authorization=`Bearer ${r}`),t},o=o=>{!(o={...t,...o}).url.startsWith("http")&&t.baseURL&&(o.url=t.baseURL+o.url);const i=`${(o=n(o)||o).method}_${o.url}_${JSON.stringify(o.data)}`;if(o.preventDuplicate){const e=r.find((e=>e.key===i));if(e)return e.request}const a=new Promise(((t,n)=>{e.index.request({...o,success:e=>{r.splice(r.findIndex((e=>e.key===i)),1),((e,t)=>(!1!==t.loading&&s(),200===e.statusCode?Promise.resolve(e.data):Promise.reject(e)))(e,o).then((e=>t(e))).catch((e=>n(e)))},fail:t=>{r.splice(r.findIndex((e=>e.key===i)),1),((t,r)=>{!1!==r.loading&&s();let n="请求失败";return t.errMsg?n=t.errMsg:t.message&&(n=t.message),401===t.statusCode&&e.index.navigateTo({url:"@/pages/login/login"}),!1!==r.showError&&e.index.showToast({title:n,icon:"none",duration:2e3}),Promise.reject(t)})(t,o).catch((e=>n(e)))}})}));return o.preventDuplicate&&r.push({key:i,request:a}),a};exports.get=(e,t={},r={})=>o({url:e,data:t,method:"GET",...r}),exports.post=(e,t={},r={})=>o({url:e,data:t,method:"POST",...r});
